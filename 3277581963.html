<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head xmlns:forms="http://www.schema.de/2010/ST4/Layout/MarkupLanguage/Forms"><meta http-equiv="Content-Script-Type" content="text/javascript" /><meta http-equiv="Content-Style-Type" content="text/css" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="generator" content="SCHEMA ST4, Bootstrap 2016 v1" /><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" /><meta name="msapplication-config" content="none" /><link rel="icon" type="image/x-icon" href="../assets/ico/bruker.ico" /><link rel="stylesheet" href="../assets/css/base/01-bootstrap.min.css" /><link rel="stylesheet" href="../assets/css/base/02-jquery-tree.css" /><link rel="stylesheet" href="../assets/css/base/03-bootstrap-schema.css" /><link rel="stylesheet" href="../assets/css/base/04-jquery.mcustomscrollbar.min.css" /><link rel="stylesheet" href="../assets/css/base/05-jquery.mmenu.oncanvas.css" /><link rel="stylesheet" href="../assets/css/base/06-jquery.mmenu.schema.css" /><link rel="stylesheet" href="../assets/css/formats.css" /><title>tf3</title></head><body id="3277581963" lang="en-US" xmlns:forms="http://www.schema.de/2010/ST4/Layout/MarkupLanguage/Forms" data-node-id="3277581963" class="" data-culture="en-US"><div class="off-canvas"><div id="off-canvas-menu" role="complementary"></div><div id="pushobj"><div class="scroll-container content-container" id="content-container"><div class="container" role="main"><ol class="breadcrumb hidden-xs"><li><a style="color:#3195CA;" href="index.html"></a></li><li><a style="color:#3195CA;" href="3277535243.html">3D Processing Commands</a></li><li>tf3</li></ol><h1 class="heading" style="color:black;">tf3</h1><div class="metalist"></div><h2 class="subheading">NAME</h2><p>tf3 - Process data, including FT, in F3 (3D) <span class=".index-entry" id="ID0E2F6O"></span></p><h2 class="subheading">DESCRIPTION</h2><p>The command <strong>tf3</strong> processes a 3D dataset in the F3 direction. F3 is the first direction of a 3D dataset, i.e. the <span class=".index-entry" id="ID0EFG6O"></span>acquisition direction. <strong>tf3</strong> always performs a <span class=".index-entry" id="ID0ELG6O"></span>Fourier transform which transforms time domain data (FID) into <span class=".index-entry" id="ID0EPG6O"></span>frequency domain data (spectrum). Depending on the processing parameters BC_mod, WDW, ME_mod and PH_mod, it also performs <span class=".index-entry" id="ID0ESG6O"></span>baseline correction, <span class=".index-entry" id="ID0EWG6O"></span>window multiplication, <span class=".index-entry" id="ID0E1G6O"></span>linear prediction and spectrum <span class=".index-entry" id="ID0E5G6O"></span>phase correction. </p><p>The processing steps done by <strong>tf3</strong> can be described as follows: </p><ol class="list"><li value="1">Baseline correction of the F3 time domain data</li><li value="2">Each row is baseline corrected according to BC_mod. This parameter takes the value <em>no</em>, <em>single</em>, <em>quad</em>, <em>spol</em>, <em>qpol</em> <em>sfil</em> or <em>qfil</em>. More details on BC_mod can be found in chapter List of processing parameters. </li><li value="3">Linear prediction of the F3 time domain data</li><li value="4">Linear prediction is done according to ME_mod. This parameter takes the value <em>no</em>, <em>LPfr</em>, <em>LPfc</em>, <em>LPbr</em>, <em>LPbc, LPmifr </em>or<em> LPmifc. </em>Usually, ME_mod = no, which means no prediction is done. Forward prediction (<em>LPfr</em>, <em>LPfc, LPmifr </em>or<em> LPmifc</em>) can, for example, be used to extend <span class=".index-entry" id="ID0E2I6O"></span>truncated FIDs. Backward prediction (<em>LPbr</em> or <em>LPbc</em>) can be used to improve the initial data points of the FID. Linear prediction is only performed if NCOEF &gt; 0. Furthermore, the parameters LPBIN and, for backward prediction, TDoff play a role (see these parameters in chapter List of processing parameters).</li><li value="5">Window<span class=".index-entry" id="ID0EKJ6O"></span> multiplication of the F3 time domain data</li><li value="6">Each row is multiplied with a window function according to WDW. This parameter takes the value <em>em</em>, <em>gm</em>, <em>sine</em>, <em>qsine</em>, <em>trap</em>, <em>user</em>, <em>sinc</em>, <em>qsinc</em>, <em>traf</em> or <em>trafs</em>. More details on WDW can be found in chapter List of processing parameters.</li><li value="7">Fourier transform of the F3 time domain data</li><li value="8">Each row is Fourier transformed according to the acquisition status parameter AQ_mod as shown in the table below. <strong>tf3</strong> does not evaluate the processing parameter FT_mod! However, it stores the Fourier transform mode in the processing status parameter FT_mod.</li><li value="9">Phase correction of the <span class=".index-entry" id="ID0EXK6O"></span>F3 frequency domain data</li><li value="10">Each row is phase corrected according to PH_mod. This parameter takes the value <em>no</em>, <em>pk</em>, <em>mc</em> or <em>ps</em>. For PH_mod = pk, <strong>tf3</strong> applies the values of PHC0 and PHC1. This is only useful if the <span class=".index-entry" id="ID0EIL6O"></span>phase values are known. You can determine them by typing <strong>xfb</strong> on the 3D data to process a 23 or 13 plane, do a phase correction on the resulting the 2D dataset and store the phase values to 3D. More details on PH_mod can be found in chapter List of processing parameters.</li></ol><table class="table tabletype-framed table-scaled"><colgroup><col style="width: 2.47cm;"></col><col style="width: 4.97cm;"></col><col style="width: 3.00cm;"></col></colgroup><tbody><tr><td><p class="text-left">AQ_mod</p>
</td><td><p class="text-left">Fourier transform mode</p>
</td><td><p class="text-left">status FT_mod</p>
</td></tr><tr><td><p class="text-left">qf </p>
</td><td><p class="text-left">forward, single, real</p>
</td><td><p class="text-left">fsr</p>
</td></tr><tr><td><p class="text-left">qsim</p>
</td><td><p class="text-left">forward, quad, complex</p>
</td><td><p class="text-left">fqc</p>
</td></tr><tr><td><p class="text-left">qseq </p>
</td><td><p class="text-left">forward, quad, real</p>
</td><td><p class="text-left">fqr </p>
</td></tr><tr><td><p class="text-left">DQD</p>
</td><td><p class="text-left">forward, quad, complex</p>
</td><td><p class="text-left">fqc</p>
</td></tr></tbody></table><p> </p><p>The size of the processed data is determined by the processing parameter SI; SI real and SI imaginary points are created. A typical value for SI is TD/2 in which case, all raw data points are used and no <span class=".index-entry" id="ID0ERO6O"></span>zero filling is done. In fact, several parameters control the number of input and output data points, for example:</p><ul class="list"><li value="1">SI &gt; TD/2: the raw data are zero filled before the <span class=".index-entry" id="ID0E1O6O"></span>Fourier transform</li><li value="2">SI &lt; TD/2: only the first 2*SI raw data points are used</li><li value="3">0 &lt; TDeff &lt; TD: only the first TDeff raw data points are used</li><li value="4">0 &lt; TDoff &lt; TD: the first TDoff raw data points are cut off and TDoff zeroes are appended at the end </li><li value="5">TDoff &lt; 0: -TDoff zeroes are prepended at the beginning. Note that:</li><ul class="list"><li value="1">for SI &lt; (TD-TDoff)/2 raw data are cut off at the end</li><li value="2">for DIGMOD=digital, the zeroes would be prepended to the group delay which does not make sense. You can avoid that by converting the raw data with <strong>convdta</strong> before you process them.</li></ul><li value="6">0 &lt; STSR &lt; SI: only the processed data between STSR and STSR+STSI are stored (if STSI = 0, STSR is ignored and SI points are stored)</li><li value="7">0 &lt; STSI &lt; SI: only the processed data between STSR and STSR+STSI are stored. </li></ul><p>Note that only in the first case the processed data contain the total information of the raw data. In all other cases, information is lost.</p><p>Before you run <strong>tf3</strong>, you must set the processing parameter SI in all three directions F3, F2 and F1. The command<strong>tf2</strong> does not evaluate the F2 processing parameter SI, it evaluates the processing status parameter SI as it was set by <strong>tf3</strong>.</p><p><strong>tf3</strong> evaluates the acquisition status parameter AQSEQ. This parameter defines the storage order of the raw data 3-2-1 or 3-1-2. For processed data, F2 and F1 are always the second and third direction, respectively. For raw data, this order can be the same or reversed as expressed by AQSEQ. </p><p><strong>tf3</strong> evaluates the processing parameter FCOR. The first point of the FIDs is multiplied with the value of FCOR which lies between 0.0 and 2.0. For <span class=".index-entry" id="ID0EQQ6O"></span>digitally filtered <span class=".index-entry" id="ID0ETQ6O"></span>Avance data, FCOR has no effect in F3 because the first point is part of the <span class=".index-entry" id="ID0EXQ6O"></span>group delay and, as such, is zero. In that case, it only plays a role in the F2 and F1 direction (see <strong>tf2</strong> and <strong>tf1</strong>). However, on A*X data or Avance data measured with DIGMOD = analog, there is no group delay and FCOR also plays a role in F3.</p><p><strong>tf3</strong> evaluates the processing parameter PKNL. On A*X spectrometers, PKNL = true causes a non linear 5th order <span class=".index-entry" id="ID0ECR6O"></span>phase correction of the raw data. This corrects possible errors caused by non linear behaviour of the analog filters. On Avance spectrometers, PKNL must always be set to TRUE. For <span class=".index-entry" id="ID0EGR6O"></span>digitally filtered data, it causes <strong>tf3</strong> to handle the <span class=".index-entry" id="ID0ELR6O"></span>group delay of the FID. For analog data it has no effect.</p><p><strong>tf3</strong> evaluates the processing parameter REVERSE. If REVERSE = TRUE, the spectrum will be <span class=".index-entry" id="ID0ESR6O"></span>reversed in F3, i.e. the first data point becomes the last and the last data point becomes the first.</p><p><strong>tf3</strong> can be used with the following command line options:</p><p><strong>n</strong> </p><p><strong>tf3</strong> will not store the <span class=".index-entry" id="ID0ECS6O"></span>imaginary data. Imaginary data are only needed for <span class=".index-entry" id="ID0EGS6O"></span>phase correction. If the <span class=".index-entry" id="ID0EKS6O"></span>phase values are already known and PHC0 and PHC1 have been set accordingly, <strong>tf3</strong> will perform phase correction and there is no need to store the imaginary data. This will save processing time and <span class=".index-entry" id="ID0EQS6O"></span>disk space. If you still need to do a phase correction after <strong>tf3</strong>, you can create imaginary data from the real data with a <span class=".index-entry" id="ID0EVS6O"></span>Hilbert transform (see <strong><span class=".index-entry" id="ID0E1S6O"></span>tht3</strong>).</p><p><strong>xdim</strong> </p><p>3D spectra are stored in the so-called <span class=".index-entry" id="ID0EFT6O"></span>subcube format. The size of the subcubes is calculated by <strong>tf3</strong> and depends on the size of the spectrum and the available memory. The option <strong>xdim</strong> allows to use predefined subcube sizes. It causes <strong>tf3</strong> to interpret the F3, F2 and F1 processing parameter XDIM which can be set with the command <strong>xdim</strong>. The actually used subcube sizes, whether predefined or calculated, are stored as the F3, F2 and F1 processing status parameter XDIM and can be viewed with <strong>dpp</strong>. Predefining subcube sizes is, for example, used to read the processed data with <span class=".index-entry" id="ID0EST6O"></span>third party software which cannot interpret the processing status parameter XDIM.</p><p><strong>big/little</strong> </p><p><strong>tf3</strong> stores the data in the data storage order of the computer it runs on, e.g. <span class=".index-entry" id="ID0E4T6O"></span>little endian on Windows PCs. Note that TopSpin’s predecessor XWIN-NMR on <span class=".index-entry" id="ID0EAU6O"></span>SGI UNIX workstations stores data in <span class=".index-entry" id="ID0EDU6O"></span>big endian.The storage order is stored in the processing status parameter BYTORDP (type <strong>s</strong> <strong>bytordp</strong>). If, however, you want to read the processed data with <span class=".index-entry" id="ID0EKU6O"></span>third party software which can not interpret this parameter, you can use the <strong>big/little</strong> option to predefine the storage order.</p><p>Normally, <strong>tf3</strong> stores the entire spectral region as determined by the spectral width. However, you can do a so-called <span class=".index-entry" id="ID0EUU6O"></span>strip transform which means that only a certain region of the spectrum is stored. This can be done by setting the parameters STSR and STSI which represent the <span class=".index-entry" id="ID0EYU6O"></span>strip start and <span class=".index-entry" id="ID0E3U6O"></span>strip size, respectively. They both can take a value between 0 and SI. The values which are actually used can be a little different. STSI is always rounded to the next higher multiple of 16. Furthermore, when the data are stored in <span class=".index-entry" id="ID0EAV6O"></span>subcube format (see below), STSI is rounded to the next multiple of the <span class=".index-entry" id="ID0EDV6O"></span>subcube size. Type <strong>dpp</strong> to check this; if XDIM is smaller than SI, then the data are stored in subcube format and STSI is a multiple of XDIM.</p><p><strong>tf3</strong> stores the data in <span class=".index-entry" id="ID0EMV6O"></span>subcube format. It automatically calculates the <span class=".index-entry" id="ID0EPV6O"></span>subcube sizes such that one row (F3) of subcubes fits in the available memory. Furthermore, one column (F2) and one <span class=".index-entry" id="ID0ESV6O"></span>tube (F1) of subcubes must fit in the available memory. The calculated subcube sizes are stored in the processing status parameter XDIM (type <strong>dpp</strong>). The alignment of the data points for sequential and subcube format is the extension of the alignment in a 2D dataset as it is shown in <a style="color:#3195CA;" href="3278749323.html#3278759435">2D data in sequential storage format</a> and <a style="color:#3195CA;" href="3278749323.html#3278754571">2D data in 8*4 submatrix storage format</a>. The storage handling is completely transparent to the user and is only of interest when the data are interpreted by <span class=".index-entry" id="ID0EBW6O"></span>third party software.</p><h2 class="subheading">INPUT PARAMETERS </h2><h2 class="subheading">F3, F2 and F1 parameters</h2><p>Set by the user with <strong>edp</strong> or by typing <strong>si</strong>, <strong>stsr</strong> etc.:</p><p>SI - size of the processed data</p><p>STSR - strip start: first output point of strip transform</p><p>STSI - number of output points of strip transform</p><p>TDeff - number of raw data points to be used for processing </p><p>TDoff - first point of the FID used for processing (default 0)</p><h2 class="subheading">F3 parameters</h2><p>Set by the user with <strong>edp</strong> or by typing <strong>bc_mod</strong>, <strong>bcfw</strong> etc.:</p><p>BC_mod - FID baseline correction mode</p><p>BCFW - filter width for BC_mod = sfil or qfil</p><p>COROFFS - correction offset for BC_mod = spol/qpol or sfil/qfil</p><p>ME_mod - FID linear prediction mode</p><p>NCOEF - number of linear prediction coefficients </p><p>LPBIN - number of points for linear prediction </p><p>TDoff - number of raw data points predicted for ME_mod = LPb*</p><p>WDW - FID window multiplication mode</p><p>LB - Lorentzian broadening factor for WDW = em or gm</p><p>GB - Gaussian broadening factor for WDW = gm, sinc or qsinc</p><p>SSB - Sine bell shift for WDW = sine, qsine, sinc or qsinc</p><p>TM1, TM2 - limits of the trapezoidal window for WDW = trap</p><p>PH_mod - phase correction mode</p><p>PHC0 - zero order phase correction value for PH_mod = pk</p><p>PHC1 - first order phase correction value for PH_mod = pk</p><p>FCOR - first (FID) data point multiplication factor (0.0-2.0, default 0.5)</p><p>REVERSE - flag indicating to reverse the spectrum</p><p>PKNL - group delay compensation (Avance) or filter correction (A*X)</p><p>Set by the acquisition, can be viewed with <strong>dpa</strong> or <strong>s</strong> <strong>aq_mod</strong> etc.:</p><p>AQ_mod - acquisition mode (determines the status FT_mod)</p><p>AQSEQ - acquisition sequence (3-2-1 or 3-1-2)</p><p>TD - time domain; number of raw data points</p><p>BYTORDA - byteorder or the raw data</p><p>NC - normalization constant</p><h2 class="subheading">F2 and F1 parameters</h2><p>Set by the acquisition, can be viewed with <strong>dpa</strong> or by typing <strong>s</strong> <strong>fnmode</strong> etc.:</p><p>FnMODE - Fourier transform mode</p><h2 class="subheading">OUTPUT PARAMETERS </h2><h2 class="subheading">F3, F2 and F1</h2><p>Can be viewed with <strong>dpp</strong> or by typing <strong>s</strong> <strong>si</strong>, <strong>s</strong> <strong>stsi</strong> etc.:</p><p>SI - size of the processed data</p><p>STSR - strip start: first output point of strip transform</p><p>STSI - strip size: number of output points of strip transform</p><p>TDeff - number of raw data points that were used for processing </p><p>TDoff - first point of the FID used for processing (default 0)</p><p>XDIM - subcube size</p><h2 class="subheading">F3 parameters</h2><p>Can be viewed with <strong>dpp</strong> or by typing <strong>s</strong> <strong>si</strong>, <strong>s</strong> <strong>tdeff</strong> etc.:</p><p>FTSIZE - Fourier transform size</p><p>FT_mod - Fourier transform mode</p><p>YMAX_p - maximum intensity of the processed data</p><p>YMIN_p - minimum intensity of the processed data</p><p>S_DEV - standard deviation of the processed data</p><p>NC_proc - intensity scaling factor</p><p>BYTORDP - byte order of the processed data</p><h2 class="subheading">F2 and F1 parameters</h2><p>Can be viewed with <strong>dpp</strong> or by typing <strong>s mc2</strong> etc.:</p><p>MC2 - Fourier transform mode</p><h2 class="subheading">INPUT FILES</h2><p><em>&lt;dir&gt;/data/&lt;user&gt;/nmr/&lt;name&gt;/&lt;expno&gt;/</em></p><p><em>ser</em> - raw data</p><p><em>acqus</em> - F3 acquisition status parameters</p><p><em>acqu2s</em> - F2 acquisition status parameters</p><p><em>acqu3s</em> - F1 acquisition status parameters</p><p><em>&lt;dir&gt;/data/&lt;user&gt;/nmr/&lt;name&gt;/&lt;expno&gt;/pdata/&lt;procno&gt;/</em></p><p><em>proc</em> - F3 processing parameters</p><p><em>proc2</em> - F2 processing parameters</p><p><em>proc3</em> - F1 processing parameters</p><h2 class="subheading">OUTPUT FILES</h2><p><em>&lt;dir&gt;/data/&lt;user&gt;/nmr/&lt;name&gt;/&lt;expno&gt;/pdata/&lt;procno&gt;/</em></p><p><em>3rrr</em> - real processed 3D data </p><p><em>3irr</em> - real/imaginary processed data (for FnMODE ≠ QF)</p><p><em>3iii</em> - real/imaginary processed data (for FnMODE = QF)</p><p><em>procs</em> - F3 processing status parameters</p><p><em>proc2s</em> - F2 processing status parameters</p><p><em>proc3s</em> - F1 processing status parameters</p><p><em>auditp.txt</em> - processing audit trail</p><h2 class="subheading">USAGE IN AU PROGRAMS</h2><p>TF3(store_imag, partition)</p><p>Where <em>store_image</em> can be <em>y</em> or <em>n</em> and <em>partition</em> is the top level data directory</p><h2 class="subheading">SEE ALSO</h2><p><a style="color:#3195CA;" href="3277587211.html">tf2</a>, <a style="color:#3195CA;" href="3277594763.html">tf1</a>, <a style="color:#3195CA;" href="3277539723.html">ft3d</a></p></div><div class="container"><footer><p class="text-muted">@ Bruker Corporation 2023</p></footer></div></div><div class="schema-navbar" id="navbar" role="navigation"><button class="schema-navbar-toggle visible-sm visible-xs" id="sidebar-toggle"><span class="schema-glyph schema-glyph-menu"></span></button><a class="schema-navbar-brand" href="index.html"><img class="schema-navbar-logo" src="../assets/img/logo_white.svg" /></a><button class="btn btn-default dropdown-toggle schema-navbar-toggle mobile-hidden-xs mobile-hidden-sm" style="margin-top:20px;" id="language-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span class="schema-glyph schema-glyph-more_vert" style="top:0;"></span></button><ul class="dropdown-menu" id="language-dropdown"><li class="dropdown-header hidden-md hidden-lg"></li><li class="hidden-md hidden-lg"><a href="index.html">Home</a></li><li class="dropdown-header">Language</li><li class="langMenuItem checked" data-value="en-US"><a href="../en-US/3277581963.html">us-english</a></li></ul><div id="navbar-search"><form class="schema-navbar-search hidden-xs pull-right" role="search" action="search.html"><input type="text" name="q" autocomplete="search2662718347" placeholder="Search" results="10" /></form></div><ul class="navbar-structure-pages hidden-sm hidden-xs "><li class="schema-home-text"><a href="index.html">Home</a></li></ul><button class="navbar-toggle schema-navbar-toggle visible-xs" data-toggle="collapse" data-target="#search-collapse"><span class="schema-glyph schema-glyph-search"></span></button><form class="collapse hidden-sm hidden-md hidden-lg" id="search-collapse" role="search" action="search.html"><input type="text" name="q" autocomplete="search2662718347" placeholder="Search" results="10" /></form></div></div></div><script type="text/javascript" charset="utf-8" src="js/treedata.json"></script><script src="../assets/js/00-jquery.min.js"></script><script src="../assets/js/01-bootstrap.min.js"></script><script src="../assets/js/02-modernizr.custom.js"></script><script src="../assets/js/03-jquery-tree.js"></script><script src="../assets/js/04-jquery.mmenu.oncanvas.min.js"></script><script src="../assets/js/05-jquery.mcustomscrollbar.min.js"></script><script src="../assets/js/06-jquery-scrollbars.min.js"></script><script src="../assets/js/18-schema-common-core.min.js"></script><script src="../assets/js/19-schema-common-search.js"></script><script src="../assets/js/20-bootstrap-schema.js"></script></body></html>